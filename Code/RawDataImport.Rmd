---
title: "RawDataImport"
author: "jhs"
date: "2025-12-02"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

This raw data import relies on essential packages tidyverse and here. We verify with `here()` that our working directory is accurate. We then import the data using the read.csv() function.

```{r, setup, echo=TRUE, include=FALSE}
#install.packages(tidyverse);install.packages(here)
library(tidyverse)
library(here)
here()
RawNCData <- data.frame(read.csv(here('Data','Raw','NCDataPortal-RAW.csv'), skip = 2), stringsAsFactors = TRUE)
```

As always, we inspect the nature of the data. We use functions head(), str(), summary(), dim(), and colnames() to view and summarize the data.

```{r, Exploring-Structure-of-Raw-Data, echo=TRUE}
head(RawNCData)
str(RawNCData)
summary(RawNCData)
dim(RawNCData)
colnames(RawNCData)
```

On first glance we see that there are many more columns representing household income in more detail than we need. Additionally, we see that all the income columns are stored as strings. We will clean this data so that just the income columns we want are in the dataframe and that those columns are numeric before moving on to other formatting. The lapply code using gsub is based on code provided in this [StackOverflow thread](https://stackoverflow.com/questions/74461334/replace-character-values-across-several-columns-at-once).

```{r, Selecting-Columns-and-Setting-Numeric, echo=TRUE}
# Select columns we intend to use and filter extraneous data
NCData_Mutate <- RawNCData %>% 
  select("County" = "Indicator.Attribute",
         "TotalHouseholds" = "Total.Family.Households",
         "AvgHHinc" = "Average.Family.Income",
         "MedHHinc" = "Median.Family.Income",
         "WalkIndexScore" = "Walkability.Index.Score",
         "LeastWalk" = "Least.Walkable",
         "BelowAvgWalk" = "Below.Average.Walkable",
         "AboveAvgWalk" = "Above.Average.Walkable",
         "MostWalk" = "Most.Walkable",
         "Total.Population",
         "PopInFHA" = "Estimated.Population.Within.a.Flood.Hazard.Area", 
         "PercentPopInFHA" = "Percentage.of.Population.Within.a.100.year.Flood.Hazard.Area",
         "DailyMaxHeatIndex95Percentile" = "Days.above.95th.Percentile.of.Daily.Maximum.Heat.Index") %>% 
  filter(County != "Report Location", County != "United States", County != "North Carolina")

# Remove special characters of $ and %
NCData_Mutate[] <- lapply(NCData_Mutate[], 
                             function(x) gsub(pattern ='[%$,]',
                                              '',
                                              x, 
                                              ignore.case = FALSE))



#coerce columns as numeric
NCData_Mutate[2:13]  <- lapply(NCData_Mutate[2:13], as.numeric) 

# Check the structure to make sure the changes are satisfactory
str(NCData_Mutate)
```

We note now that without the percent symbol, integers and percentages are now indistinguishable. We will mutate percent columns to be decimals for clarity.

```{r Mutate-Percents-to-Decimals, echo=TRUE}
NCData <- NCData_Mutate %>% 
  mutate(LeastWalk = LeastWalk/100,
         BelowAvgWalk = BelowAvgWalk/100,
         AboveAvgWalk = AboveAvgWalk/100,
         MostWalk = MostWalk/100,
         PercentPopInFHA = PercentPopInFHA/100) %>% 
  select(County,
          Total.Population,
          TotalHouseholds,
          AvgHHinc,
          MedHHinc,
          WalkIndexScore,
          LeastWalk,
          BelowAvgWalk,
          AboveAvgWalk,
          MostWalk,
          PopInFHA,
          PercentPopInFHA,
         DailyMaxHeatIndex95Percentile)

str(NCData)
```

The data is now clean. We will save it to a new CSV and begin exploratory analysis in a new script.

```{r, Save-File, echo=TRUE}
write.csv(NCData, here('Data','Processed', "NCDataClean.csv"))
```
